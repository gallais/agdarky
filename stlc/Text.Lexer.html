<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Lexer</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Option">--without-K</a> <a id="25" class="Option">--safe</a> <a id="32" class="Symbol">#-}</a>

<a id="37" class="Keyword">open</a> <a id="42" class="Keyword">import</a> <a id="49" href="Level.html" class="Module">Level</a>
<a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="77" class="Keyword">open</a> <a id="82" class="Keyword">import</a> <a id="89" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.Char.html" class="Module">Data.Char</a>          <a id="130" class="Symbol">as</a> <a id="133" class="Module">Char</a>
<a id="138" class="Keyword">open</a> <a id="143" class="Keyword">import</a> <a id="150" href="Data.Char.Unsafe.html" class="Module">Data.Char.Unsafe</a>
<a id="167" class="Keyword">open</a> <a id="172" class="Keyword">import</a> <a id="179" href="Data.List.html" class="Module">Data.List</a>          <a id="198" class="Symbol">as</a> <a id="201" class="Module">List</a> <a id="206" class="Keyword">using</a> <a id="212" class="Symbol">(</a><a id="213" href="Agda.Builtin.List.html#80" class="Datatype">List</a><a id="217" class="Symbol">;</a> <a id="219" href="Data.List.Base.html#8785" class="InductiveConstructor">[]</a><a id="221" class="Symbol">;</a> <a id="223" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">_∷_</a><a id="226" class="Symbol">)</a>
<a id="228" class="Keyword">open</a> <a id="233" class="Keyword">import</a> <a id="240" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="259" class="Symbol">as</a> <a id="262" class="Module">List⁺</a> <a id="268" class="Keyword">using</a> <a id="274" class="Symbol">(</a><a id="275" href="Data.List.NonEmpty.html#1135" class="Record">List⁺</a><a id="280" class="Symbol">;</a> <a id="282" href="Data.List.NonEmpty.html#1185" class="InductiveConstructor Operator">_∷_</a><a id="285" class="Symbol">)</a>
<a id="287" class="Keyword">open</a> <a id="292" class="Keyword">import</a> <a id="299" href="Data.Maybe.html" class="Module">Data.Maybe</a>         <a id="318" class="Symbol">as</a> <a id="321" class="Module">Maybe</a>
<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Data.Product.html" class="Module">Data.Product</a>       <a id="358" class="Symbol">as</a> <a id="361" class="Module">Prod</a>
<a id="366" class="Keyword">open</a> <a id="371" class="Keyword">import</a> <a id="378" href="Data.String.Base.html" class="Module">Data.String.Base</a>   <a id="397" class="Symbol">as</a> <a id="400" class="Module">String</a> <a id="407" class="Keyword">using</a> <a id="413" class="Symbol">(</a><a id="414" href="Agda.Builtin.String.html#165" class="Postulate">String</a><a id="420" class="Symbol">)</a>
<a id="422" class="Keyword">open</a> <a id="427" class="Keyword">import</a> <a id="434" href="Data.These.html" class="Module">Data.These</a>         <a id="453" class="Symbol">as</a> <a id="456" class="Module">These</a>

<a id="463" class="Keyword">open</a> <a id="468" class="Keyword">import</a> <a id="475" href="Function.html" class="Module">Function</a>

<a id="485" class="Keyword">open</a> <a id="490" class="Keyword">import</a> <a id="497" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="518" class="Symbol">as</a> <a id="521" class="Module">Pos</a> <a id="525" class="Keyword">using</a> <a id="531" class="Symbol">(</a><a id="532" href="Text.Parser.Position.html#310" class="Record">Position</a><a id="540" class="Symbol">)</a>

<a id="543" class="Keyword">module</a> <a id="550" href="Text.Lexer.html" class="Module">Text.Lexer</a>
  <a id="563" class="Comment">-- Our lexer is parametrised over the type of tokens</a>
  <a id="618" class="Symbol">{</a><a id="619" href="Text.Lexer.html#619" class="Bound">t</a><a id="620" class="Symbol">}</a> <a id="622" class="Symbol">{</a><a id="623" href="Text.Lexer.html#623" class="Bound">Tok</a> <a id="627" class="Symbol">:</a> <a id="629" class="PrimitiveType">Set</a> <a id="633" href="Text.Lexer.html#619" class="Bound">t</a><a id="634" class="Symbol">}</a>
  <a id="638" class="Comment">-- We start with an association list between</a>
  <a id="685" class="Comment">-- * keywords (as Strings)</a>
  <a id="714" class="Comment">-- * keywords (as token values)</a>
  <a id="748" class="Symbol">(</a><a id="749" href="Text.Lexer.html#749" class="Bound">keywords</a> <a id="758" class="Symbol">:</a> <a id="760" href="Data.List.NonEmpty.html#1135" class="Record">List⁺</a> <a id="766" class="Symbol">(</a><a id="767" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="774" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="776" href="Text.Lexer.html#623" class="Bound">Tok</a><a id="779" class="Symbol">))</a>
  <a id="784" class="Comment">-- Some characters are special: they are separators, breaking a string into</a>
  <a id="862" class="Comment">-- a list of tokens. Some are associated to a token value (e.g. parentheses)</a>
  <a id="941" class="Comment">-- others are not (e.g. space)</a>
  <a id="974" class="Symbol">(</a><a id="975" href="Text.Lexer.html#975" class="Bound">breaking</a> <a id="984" class="Symbol">:</a> <a id="986" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a> <a id="991" class="Symbol">→</a> <a id="993" href="Data.Product.html#881" class="Function">∃</a> <a id="995" class="Symbol">λ</a> <a id="997" href="Text.Lexer.html#997" class="Bound">b</a> <a id="999" class="Symbol">→</a> <a id="1001" href="Data.Bool.Base.html#904" class="Function Operator">if</a> <a id="1004" href="Text.Lexer.html#997" class="Bound">b</a> <a id="1006" href="Data.Bool.Base.html#904" class="Function Operator">then</a> <a id="1011" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="1017" href="Text.Lexer.html#623" class="Bound">Tok</a> <a id="1021" href="Data.Bool.Base.html#904" class="Function Operator">else</a> <a id="1026" href="Level.html#358" class="Record">Lift</a> <a id="1031" class="Symbol">_</a> <a id="1033" href="Agda.Builtin.Unit.html#69" class="Record">⊤</a><a id="1034" class="Symbol">)</a>
  <a id="1038" class="Comment">-- Finally, strings which are not decoded as keywords are coerced using a</a>
  <a id="1114" class="Comment">-- function to token values.</a>
  <a id="1145" class="Symbol">(</a><a id="1146" href="Text.Lexer.html#1146" class="Bound">default</a>  <a id="1155" class="Symbol">:</a> <a id="1157" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1164" class="Symbol">→</a> <a id="1166" href="Text.Lexer.html#623" class="Bound">Tok</a><a id="1169" class="Symbol">)</a>
  <a id="1173" class="Keyword">where</a>

  <a id="Result"></a><a id="1182" href="Text.Lexer.html#1182" class="Function">Result</a> <a id="1189" class="Symbol">:</a> <a id="1191" class="PrimitiveType">Set</a> <a id="1195" class="Symbol">_</a>
  <a id="1199" href="Text.Lexer.html#1182" class="Function">Result</a> <a id="1206" class="Symbol">=</a> <a id="1208" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="1213" class="Symbol">(</a><a id="1214" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="1223" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="1225" href="Text.Lexer.html#623" class="Bound">Tok</a><a id="1228" class="Symbol">)</a>

  <a id="tokenize"></a><a id="1233" href="Text.Lexer.html#1233" class="Function">tokenize</a> <a id="1242" class="Symbol">:</a> <a id="1244" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1251" class="Symbol">→</a> <a id="1253" href="Text.Lexer.html#1182" class="Function">Result</a>
  <a id="1262" href="Text.Lexer.html#1233" class="Function">tokenize</a> <a id="1271" class="Symbol">=</a> <a id="1273" href="Text.Lexer.html#2014" class="Function">start</a> <a id="1279" href="Text.Parser.Position.html#409" class="Function">Pos.start</a> <a id="1289" href="Function.html#958" class="Function Operator">∘′</a> <a id="1292" href="Data.String.Base.html#869" class="Function">String.toList</a> <a id="1306" class="Keyword">where</a>

   <a id="1316" class="Keyword">mutual</a>

    <a id="1328" class="Comment">-- We build a trie from the association list so that we may easily compute</a>
    <a id="1407" class="Comment">-- the successive derivatives obtained by eating the characters one by one</a>
    <a id="1486" href="Text.Lexer.html#1486" class="Function">Keywords</a> <a id="1495" class="Symbol">:</a> <a id="1497" class="PrimitiveType">Set</a> <a id="1501" class="Symbol">_</a>
    <a id="1507" href="Text.Lexer.html#1486" class="Function">Keywords</a> <a id="1516" class="Symbol">=</a> <a id="1518" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="1523" class="Symbol">(</a><a id="1524" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="1529" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a> <a id="1534" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="1536" href="Text.Lexer.html#623" class="Bound">Tok</a><a id="1539" class="Symbol">)</a>

    <a id="1546" href="Text.Lexer.html#1546" class="Function">init</a> <a id="1551" class="Symbol">:</a> <a id="1553" href="Text.Lexer.html#1486" class="Function">Keywords</a>
    <a id="1566" href="Text.Lexer.html#1546" class="Function">init</a> <a id="1571" class="Symbol">=</a> <a id="1573" href="Data.List.Base.html#1120" class="Function">List.map</a> <a id="1582" class="Symbol">(</a><a id="1583" href="Data.Product.html#2333" class="Function">Prod.map₁</a> <a id="1593" href="Data.String.Base.html#869" class="Function">String.toList</a><a id="1606" class="Symbol">)</a> <a id="1608" href="Function.html#1891" class="Function Operator">$</a> <a id="1610" href="Data.List.NonEmpty.html#1665" class="Function">List⁺.toList</a> <a id="1623" href="Function.html#1891" class="Function Operator">$</a> <a id="1625" href="Text.Lexer.html#749" class="Bound">keywords</a>

    <a id="1639" href="Text.Lexer.html#1639" class="Function">read</a> <a id="1644" class="Symbol">:</a> <a id="1646" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a> <a id="1651" class="Symbol">→</a> <a id="1653" href="Text.Lexer.html#1486" class="Function">Keywords</a> <a id="1662" class="Symbol">→</a> <a id="1664" href="Text.Lexer.html#1486" class="Function">Keywords</a>
    <a id="1677" href="Text.Lexer.html#1639" class="Function">read</a> <a id="1682" href="Text.Lexer.html#1682" class="Bound">t</a> <a id="1684" class="Symbol">=</a> <a id="1686" href="Data.List.Base.html#1239" class="Function">List.mapMaybe</a> <a id="1700" href="Function.html#1891" class="Function Operator">$</a> <a id="1702" class="Symbol">λ</a> <a id="1704" class="Keyword">where</a>
      <a id="1716" class="Symbol">(</a><a id="1717" href="Text.Lexer.html#1717" class="Bound">c</a> <a id="1719" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="1721" href="Text.Lexer.html#1721" class="Bound">cs</a> <a id="1724" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1726" href="Text.Lexer.html#1726" class="Bound">tok</a><a id="1729" class="Symbol">)</a> <a id="1731" class="Symbol">→</a> <a id="1733" href="Data.Bool.Base.html#904" class="Function Operator">if</a> <a id="1736" href="Text.Lexer.html#1717" class="Bound">c</a> <a id="1738" href="Data.Char.Unsafe.html#1294" class="Function Operator">==</a> <a id="1741" href="Text.Lexer.html#1682" class="Bound">t</a> <a id="1743" href="Data.Bool.Base.html#904" class="Function Operator">then</a> <a id="1748" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a> <a id="1753" class="Symbol">(</a><a id="1754" href="Text.Lexer.html#1721" class="Bound">cs</a> <a id="1757" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1759" href="Text.Lexer.html#1726" class="Bound">tok</a><a id="1762" class="Symbol">)</a> <a id="1764" href="Data.Bool.Base.html#904" class="Function Operator">else</a> <a id="1769" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a>
      <a id="1783" class="CatchallClause Symbol">_</a> <a id="1785" class="Symbol">→</a> <a id="1787" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a>

    <a id="1800" href="Text.Lexer.html#1800" class="Function">value</a> <a id="1806" class="Symbol">:</a> <a id="1808" href="Text.Lexer.html#1486" class="Function">Keywords</a> <a id="1817" class="Symbol">→</a> <a id="1819" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="1825" href="Text.Lexer.html#623" class="Bound">Tok</a>
    <a id="1833" href="Text.Lexer.html#1800" class="Function">value</a> <a id="1839" href="Text.Lexer.html#1839" class="Bound">ks</a> <a id="1842" class="Symbol">=</a> <a id="1844" href="Data.List.Base.html#6545" class="Function">List.head</a> <a id="1854" href="Function.html#1891" class="Function Operator">$</a> <a id="1856" href="Function.html#1536" class="Function">flip</a> <a id="1861" href="Data.List.Base.html#1239" class="Function">List.mapMaybe</a> <a id="1875" href="Text.Lexer.html#1839" class="Bound">ks</a> <a id="1878" href="Function.html#1891" class="Function Operator">$</a> <a id="1880" class="Symbol">λ</a> <a id="1882" class="Keyword">where</a>
      <a id="1894" class="Symbol">(</a><a id="1895" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a> <a id="1898" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1900" href="Text.Lexer.html#1900" class="Bound">k</a><a id="1901" class="Symbol">)</a> <a id="1903" class="Symbol">→</a> <a id="1905" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a> <a id="1910" href="Text.Lexer.html#1900" class="Bound">k</a>
      <a id="1918" class="CatchallClause Symbol">_</a> <a id="1920" class="Symbol">→</a> <a id="1922" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a>

    <a id="1935" class="Comment">-- Kickstart the tokeniser with an empty accumulator and the initial trie.</a>
    <a id="2014" href="Text.Lexer.html#2014" class="Function">start</a> <a id="2020" class="Symbol">:</a> <a id="2022" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="2031" class="Symbol">→</a> <a id="2033" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="2038" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a> <a id="2043" class="Symbol">→</a> <a id="2045" href="Text.Lexer.html#1182" class="Function">Result</a>
    <a id="2056" href="Text.Lexer.html#2014" class="Function">start</a> <a id="2062" href="Text.Lexer.html#2062" class="Bound">p</a> <a id="2064" class="Symbol">=</a> <a id="2066" href="Text.Lexer.html#2113" class="Function">loop</a> <a id="2071" class="Symbol">(</a><a id="2072" href="Text.Lexer.html#2062" class="Bound">p</a> <a id="2074" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="2076" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a><a id="2078" class="Symbol">)</a> <a id="2080" href="Text.Lexer.html#1546" class="Function">init</a> <a id="2085" href="Text.Lexer.html#2062" class="Bound">p</a>

    <a id="2092" class="Comment">-- The main loop</a>
    <a id="2113" href="Text.Lexer.html#2113" class="Function">loop</a> <a id="2118" class="Symbol">:</a>
      <a id="2126" class="Symbol">(</a><a id="2127" href="Text.Lexer.html#2127" class="Bound">acc</a>  <a id="2132" class="Symbol">:</a> <a id="2134" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="2143" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="2145" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="2150" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a><a id="2154" class="Symbol">)</a> <a id="2156" class="Symbol">→</a> <a id="2158" class="Comment">-- start position &amp; chars read so far in this token</a>
      <a id="2216" class="Symbol">(</a><a id="2217" href="Text.Lexer.html#2217" class="Bound">toks</a> <a id="2222" class="Symbol">:</a> <a id="2224" href="Text.Lexer.html#1486" class="Function">Keywords</a><a id="2232" class="Symbol">)</a>             <a id="2246" class="Symbol">→</a> <a id="2248" class="Comment">-- keyword candidates left at this point</a>
      <a id="2295" class="Symbol">(</a><a id="2296" href="Text.Lexer.html#2296" class="Bound">pos</a> <a id="2300" class="Symbol">:</a> <a id="2302" href="Text.Parser.Position.html#310" class="Record">Position</a><a id="2310" class="Symbol">)</a>              <a id="2325" class="Symbol">→</a> <a id="2327" class="Comment">-- current position in the input string</a>
      <a id="2373" class="Symbol">(</a><a id="2374" href="Text.Lexer.html#2374" class="Bound">input</a> <a id="2380" class="Symbol">:</a> <a id="2382" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="2387" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a><a id="2391" class="Symbol">)</a>           <a id="2403" class="Symbol">→</a> <a id="2405" class="Comment">-- list of chars to tokenize</a>
      <a id="2440" href="Text.Lexer.html#1182" class="Function">Result</a>
    <a id="2451" class="Comment">-- Empty input: finish up, check whether we have a non-empty accumulator</a>
    <a id="2528" href="Text.Lexer.html#2113" class="Function">loop</a> <a id="2533" href="Text.Lexer.html#2533" class="Bound">acc</a> <a id="2537" href="Text.Lexer.html#2537" class="Bound">toks</a> <a id="2542" href="Text.Lexer.html#2542" class="Bound">pos</a> <a id="2546" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a>         <a id="2557" class="Symbol">=</a> <a id="2559" href="Text.Lexer.html#3510" class="Function">push</a> <a id="2564" href="Text.Lexer.html#2533" class="Bound">acc</a> <a id="2568" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a>
    <a id="2575" class="Comment">-- At least one character</a>
    <a id="2605" href="Text.Lexer.html#2113" class="Function">loop</a> <a id="2610" href="Text.Lexer.html#2610" class="Bound">acc</a> <a id="2614" href="Text.Lexer.html#2614" class="Bound">toks</a> <a id="2619" href="Text.Lexer.html#2619" class="Bound">pos</a> <a id="2623" class="Symbol">(</a><a id="2624" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="2626" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="2628" href="Text.Lexer.html#2628" class="Bound">cs</a><a id="2630" class="Symbol">)</a>   <a id="2634" class="Symbol">=</a> <a id="2636" href="Function.html#3497" class="Function Operator">case</a> <a id="2641" href="Text.Lexer.html#975" class="Bound">breaking</a> <a id="2650" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="2652" href="Function.html#3497" class="Function Operator">of</a> <a id="2655" class="Symbol">λ</a> <a id="2657" class="Keyword">where</a>
      <a id="2669" class="Comment">-- if we are supposed to break on this character, we do</a>
      <a id="2731" class="Symbol">(</a><a id="2732" href="Agda.Builtin.Bool.html#92" class="InductiveConstructor">true</a> <a id="2737" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="2739" href="Text.Lexer.html#2739" class="Bound">m</a><a id="2740" class="Symbol">)</a>  <a id="2743" class="Symbol">→</a> <a id="2745" href="Text.Lexer.html#3510" class="Function">push</a> <a id="2750" href="Text.Lexer.html#2610" class="Bound">acc</a> <a id="2754" href="Function.html#1891" class="Function Operator">$</a> <a id="2756" href="Text.Lexer.html#3811" class="Function">break</a> <a id="2762" href="Text.Lexer.html#2619" class="Bound">pos</a> <a id="2766" href="Text.Lexer.html#2739" class="Bound">m</a> <a id="2768" href="Function.html#1891" class="Function Operator">$</a> <a id="2770" href="Text.Lexer.html#2014" class="Function">start</a> <a id="2776" class="Symbol">(</a><a id="2777" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="2788" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="2790" href="Text.Lexer.html#2619" class="Bound">pos</a><a id="2793" class="Symbol">)</a> <a id="2795" href="Text.Lexer.html#2628" class="Bound">cs</a>
      <a id="2804" class="Comment">-- otherwise we see whether reading it leads to a recognized keyword</a>
      <a id="2879" class="Symbol">(</a><a id="2880" href="Agda.Builtin.Bool.html#86" class="InductiveConstructor">false</a> <a id="2886" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="2888" class="Symbol">_)</a> <a id="2891" class="Symbol">→</a> <a id="2893" class="Keyword">let</a> <a id="2897" href="Text.Lexer.html#2897" class="Bound">toks&#39;</a> <a id="2903" class="Symbol">=</a> <a id="2905" href="Text.Lexer.html#1639" class="Function">read</a> <a id="2910" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="2912" href="Text.Lexer.html#2614" class="Bound">toks</a> <a id="2917" class="Keyword">in</a> <a id="2920" href="Function.html#3497" class="Function Operator">case</a> <a id="2925" href="Text.Lexer.html#1800" class="Function">value</a> <a id="2931" href="Text.Lexer.html#2897" class="Bound">toks&#39;</a> <a id="2937" href="Function.html#3497" class="Function Operator">of</a> <a id="2940" class="Symbol">λ</a> <a id="2942" class="Keyword">where</a>
        <a id="2956" class="Comment">-- if so we can forget about the current accumulator and restart</a>
        <a id="3029" class="Comment">-- the tokenizer on the rest of the input</a>
        <a id="3079" class="Symbol">(</a><a id="3080" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a> <a id="3085" href="Text.Lexer.html#3085" class="Bound">k</a><a id="3086" class="Symbol">)</a> <a id="3088" class="Symbol">→</a> <a id="3090" class="Symbol">(</a><a id="3091" href="Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="3097" href="Text.Lexer.html#2610" class="Bound">acc</a> <a id="3101" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3103" href="Text.Lexer.html#3085" class="Bound">k</a><a id="3104" class="Symbol">)</a> <a id="3106" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="3108" href="Text.Lexer.html#2014" class="Function">start</a> <a id="3114" class="Symbol">(</a><a id="3115" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="3126" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="3128" href="Text.Lexer.html#2619" class="Bound">pos</a><a id="3131" class="Symbol">)</a> <a id="3133" href="Text.Lexer.html#2628" class="Bound">cs</a>
        <a id="3144" class="Comment">-- otherwise we record the character we read in the accumulator,</a>
        <a id="3217" class="Comment">-- and keep going with the derivative of the map of keyword candidates</a>
        <a id="3296" class="Comment">-- and the rest of the input</a>
        <a id="3333" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a>  <a id="3342" class="Symbol">→</a> <a id="3344" href="Text.Lexer.html#2113" class="Function">loop</a> <a id="3349" class="Symbol">(</a><a id="3350" href="Data.Product.html#2438" class="Function">Prod.map₂</a> <a id="3360" class="Symbol">(</a><a id="3361" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="3363" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷_</a><a id="3365" class="Symbol">)</a> <a id="3367" href="Text.Lexer.html#2610" class="Bound">acc</a><a id="3370" class="Symbol">)</a> <a id="3372" href="Text.Lexer.html#2897" class="Bound">toks&#39;</a> <a id="3378" class="Symbol">(</a><a id="3379" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="3390" href="Text.Lexer.html#2624" class="Bound">c</a> <a id="3392" href="Text.Lexer.html#2619" class="Bound">pos</a><a id="3395" class="Symbol">)</a> <a id="3397" href="Text.Lexer.html#2628" class="Bound">cs</a>

    <a id="3405" class="Comment">-- Grab the accumulator and, unless it is empty, push it on top of the</a>
    <a id="3480" class="Comment">-- decoded list of tokens</a>
    <a id="3510" href="Text.Lexer.html#3510" class="Function">push</a> <a id="3515" class="Symbol">:</a> <a id="3517" class="Symbol">(</a><a id="3518" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="3527" href="Data.Product.html#1353" class="Function Operator">×</a> <a id="3529" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="3534" href="Agda.Builtin.Char.html#132" class="Postulate">Char</a><a id="3538" class="Symbol">)</a> <a id="3540" class="Symbol">→</a> <a id="3542" href="Text.Lexer.html#1182" class="Function">Result</a> <a id="3549" class="Symbol">→</a> <a id="3551" href="Text.Lexer.html#1182" class="Function">Result</a>
    <a id="3562" href="Text.Lexer.html#3510" class="Function">push</a> <a id="3567" class="Symbol">(</a><a id="3568" href="Text.Lexer.html#3568" class="Bound">pos</a> <a id="3572" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3574" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a><a id="3576" class="Symbol">)</a> <a id="3578" href="Text.Lexer.html#3578" class="Bound">ts</a> <a id="3581" class="Symbol">=</a> <a id="3583" href="Text.Lexer.html#3578" class="Bound">ts</a>
    <a id="3590" href="Text.Lexer.html#3510" class="CatchallClause Function">push</a><a id="3594" class="CatchallClause"> </a><a id="3595" class="CatchallClause Symbol">(</a><a id="3596" href="Text.Lexer.html#3596" class="CatchallClause Bound">pos</a><a id="3599" class="CatchallClause"> </a><a id="3600" href="Agda.Builtin.Sigma.html#139" class="CatchallClause InductiveConstructor Operator">,</a><a id="3601" class="CatchallClause"> </a><a id="3602" href="Text.Lexer.html#3602" class="CatchallClause Bound">cs</a><a id="3604" class="CatchallClause Symbol">)</a><a id="3605" class="CatchallClause"> </a><a id="3606" href="Text.Lexer.html#3606" class="CatchallClause Bound">ts</a> <a id="3609" class="Symbol">=</a> <a id="3611" class="Symbol">(</a><a id="3612" href="Text.Lexer.html#3596" class="Bound">pos</a> <a id="3616" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3618" href="Text.Lexer.html#1146" class="Bound">default</a> <a id="3626" class="Symbol">(</a><a id="3627" href="Data.String.Base.html#924" class="Function">String.fromList</a> <a id="3643" class="Symbol">(</a><a id="3644" href="Data.List.Base.html#8504" class="Function">List.reverse</a> <a id="3657" href="Text.Lexer.html#3602" class="Bound">cs</a><a id="3659" class="Symbol">)))</a> <a id="3663" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="3665" href="Text.Lexer.html#3606" class="Bound">ts</a>

    <a id="3673" class="Comment">-- The action corresponding to a breaking character: we only push something</a>
    <a id="3753" class="Comment">-- if the breaking character is associated to a token</a>
    <a id="3811" href="Text.Lexer.html#3811" class="Function">break</a> <a id="3817" class="Symbol">:</a> <a id="3819" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="3828" class="Symbol">→</a> <a id="3830" href="Data.Maybe.Base.html#335" class="Datatype">Maybe</a> <a id="3836" href="Text.Lexer.html#623" class="Bound">Tok</a> <a id="3840" class="Symbol">→</a> <a id="3842" href="Text.Lexer.html#1182" class="Function">Result</a> <a id="3849" class="Symbol">→</a> <a id="3851" href="Text.Lexer.html#1182" class="Function">Result</a>
    <a id="3862" href="Text.Lexer.html#3811" class="Function">break</a> <a id="3868" href="Text.Lexer.html#3868" class="Bound">pos</a> <a id="3872" class="Symbol">(</a><a id="3873" href="Data.Maybe.Base.html#373" class="InductiveConstructor">just</a> <a id="3878" href="Text.Lexer.html#3878" class="Bound">tok</a><a id="3881" class="Symbol">)</a> <a id="3883" href="Text.Lexer.html#3883" class="Bound">rs</a> <a id="3886" class="Symbol">=</a> <a id="3888" class="Symbol">(</a><a id="3889" href="Text.Lexer.html#3868" class="Bound">pos</a> <a id="3893" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3895" href="Text.Lexer.html#3878" class="Bound">tok</a><a id="3898" class="Symbol">)</a> <a id="3900" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="3902" href="Text.Lexer.html#3883" class="Bound">rs</a>
    <a id="3909" href="Text.Lexer.html#3811" class="Function">break</a> <a id="3915" href="Text.Lexer.html#3915" class="Bound">pos</a> <a id="3919" href="Data.Maybe.Base.html#403" class="InductiveConstructor">nothing</a>    <a id="3930" href="Text.Lexer.html#3930" class="Bound">rs</a> <a id="3933" class="Symbol">=</a> <a id="3935" href="Text.Lexer.html#3930" class="Bound">rs</a>
</pre></body></html>