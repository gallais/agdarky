<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Scopecheck</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">module</a> <a id="8" href="Scopecheck.html" class="Module">Scopecheck</a> <a id="19" class="Keyword">where</a>

<a id="26" class="Keyword">open</a> <a id="31" class="Keyword">import</a> <a id="38" href="Data.Product.html" class="Module">Data.Product</a> <a id="51" class="Symbol">as</a> <a id="54" class="Module">Product</a>
<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Data.String.html" class="Module">Data.String</a>
<a id="107" class="Keyword">open</a> <a id="112" class="Keyword">import</a> <a id="119" href="Data.String.Unsafe.html" class="Module">Data.String.Unsafe</a> <a id="138" class="Symbol">as</a> <a id="141" class="Module">String</a>
<a id="148" class="Keyword">open</a> <a id="153" class="Keyword">import</a> <a id="160" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="176" class="Keyword">using</a> <a id="182" class="Symbol">(</a><a id="183" href="Data.Maybe.Base.html#710" class="Datatype">Maybe</a><a id="188" class="Symbol">;</a> <a id="190" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a><a id="197" class="Symbol">;</a> <a id="199" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a><a id="203" class="Symbol">;</a> <a id="205" href="Data.Maybe.Base.html#1618" class="Function">maybe′</a><a id="211" class="Symbol">)</a>
<a id="213" class="Keyword">open</a> <a id="218" class="Keyword">import</a> <a id="225" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="239" class="Symbol">as</a> <a id="242" class="Module">Sum</a> <a id="246" class="Keyword">using</a> <a id="252" class="Symbol">(</a><a id="253" href="Data.Sum.Base.html#565" class="InductiveConstructor">inj₁</a><a id="257" class="Symbol">;</a> <a id="259" href="Data.Sum.Base.html#590" class="InductiveConstructor">inj₂</a><a id="263" class="Symbol">;</a> <a id="265" href="Data.Sum.Base.html#1017" class="Function Operator">[_,_]′</a><a id="271" class="Symbol">)</a>
<a id="273" class="Keyword">open</a> <a id="278" class="Keyword">import</a> <a id="285" href="Data.List.html" class="Module">Data.List</a> <a id="295" class="Symbol">as</a> <a id="298" class="Module">List</a> <a id="303" class="Keyword">using</a> <a id="309" class="Symbol">(</a><a id="310" href="Data.List.Base.html#9863" class="InductiveConstructor">[]</a><a id="312" class="Symbol">)</a>
<a id="314" class="Keyword">open</a> <a id="319" class="Keyword">import</a> <a id="326" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a> <a id="355" class="Symbol">as</a> <a id="358" class="Module">All</a> <a id="362" class="Keyword">using</a> <a id="368" class="Symbol">(</a><a id="369" href="Data.List.Relation.Unary.All.html#967" class="Datatype">All</a><a id="372" class="Symbol">)</a>
<a id="374" class="Keyword">open</a> <a id="379" class="Keyword">import</a> <a id="386" href="Data.List.Relation.Unary.All.Properties.html" class="Module">Data.List.Relation.Unary.All.Properties</a>
<a id="426" class="Keyword">open</a> <a id="431" class="Keyword">import</a> <a id="438" href="Function.html" class="Module">Function</a>

<a id="448" class="Keyword">open</a> <a id="453" class="Keyword">import</a> <a id="460" href="Category.Monad.html" class="Module">Category.Monad</a>
<a id="475" class="Keyword">open</a> <a id="480" class="Keyword">import</a> <a id="487" href="Category.Monad.State.html" class="Module">Category.Monad.State</a>

<a id="509" class="Keyword">open</a> <a id="514" class="Keyword">import</a> <a id="521" href="Generic.Syntax.html" class="Module">Generic.Syntax</a>
<a id="536" class="Keyword">open</a> <a id="541" class="Keyword">import</a> <a id="548" href="Generic.AltSyntax.html" class="Module">Generic.AltSyntax</a>

<a id="567" class="Keyword">open</a> <a id="572" class="Keyword">import</a> <a id="579" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a>

<a id="601" class="Keyword">open</a> <a id="606" class="Keyword">import</a> <a id="613" href="Language.html" class="Module">Language</a>
<a id="622" class="Keyword">open</a> <a id="627" href="Language.html#1919" class="Module">Surface</a>
<a id="635" class="Keyword">open</a> <a id="640" class="Keyword">import</a> <a id="647" href="Types.html" class="Module">Types</a>

<a id="654" class="Keyword">module</a> <a id="661" href="Scopecheck.html#661" class="Module">_</a> <a id="663" class="Keyword">where</a>

  <a id="672" href="Scopecheck.html#672" class="Function">M</a> <a id="674" class="Symbol">=</a> <a id="676" href="Category.Monad.State.html#4416" class="Function">State</a> <a id="682" class="Symbol">(</a><a id="683" href="Data.Map.html#364" class="Function">Map</a> <a id="687" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="689" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="690" class="Symbol">)</a>
  <a id="694" class="Keyword">open</a> <a id="699" href="Category.Monad.State.html#3607" class="Module">RawMonadState</a> <a id="713" class="Symbol">(</a><a id="714" href="Category.Monad.State.html#4574" class="Function">StateMonadState</a> <a id="730" class="Symbol">(</a><a id="731" href="Data.Map.html#364" class="Function">Map</a> <a id="735" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="737" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="738" class="Symbol">))</a>

  <a id="744" href="Scopecheck.html#744" class="Function">resolve</a> <a id="752" class="Symbol">:</a> <a id="754" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="761" class="Symbol">→</a> <a id="763" href="Scopecheck.html#672" class="Function">M</a> <a id="765" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a>
  <a id="769" href="Scopecheck.html#744" class="Function">resolve</a> <a id="777" href="Scopecheck.html#777" class="Bound">str</a> <a id="781" class="Symbol">=</a> <a id="783" class="Keyword">do</a>
    <a id="790" class="Symbol">(</a><a id="791" href="Scopecheck.html#791" class="Bound">mp</a> <a id="794" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="796" href="Scopecheck.html#796" class="Bound">gen</a><a id="799" class="Symbol">)</a> <a id="801" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="803" href="Category.Monad.State.html#2900" class="Function">get</a>
    <a id="811" href="Function.html#3533" class="Function Operator">case</a> <a id="816" href="Data.Map.html#517" class="Function">Map.assoc</a> <a id="826" href="Scopecheck.html#777" class="Bound">str</a> <a id="830" href="Scopecheck.html#791" class="Bound">mp</a> <a id="833" href="Function.html#3533" class="Function Operator">of</a> <a id="836" class="Symbol">λ</a> <a id="838" class="Keyword">where</a>
      <a id="850" class="Symbol">(</a><a id="851" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a> <a id="856" href="Scopecheck.html#856" class="Bound">n</a><a id="857" class="Symbol">)</a> <a id="859" class="Symbol">→</a> <a id="861" href="Category.Monad.Indexed.html#569" class="Function">return</a> <a id="868" href="Scopecheck.html#856" class="Bound">n</a>
      <a id="876" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>  <a id="885" class="Symbol">→</a> <a id="887" class="Keyword">do</a>
        <a id="898" href="Category.Monad.State.html#2932" class="Function">put</a> <a id="902" class="Symbol">(</a><a id="903" href="Data.Map.html#462" class="Function">Map.set</a> <a id="911" href="Scopecheck.html#777" class="Bound">str</a> <a id="915" href="Scopecheck.html#796" class="Bound">gen</a> <a id="919" href="Scopecheck.html#791" class="Bound">mp</a> <a id="922" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="924" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="928" href="Scopecheck.html#796" class="Bound">gen</a><a id="931" class="Symbol">)</a>
        <a id="941" href="Category.Monad.Indexed.html#569" class="Function">return</a> <a id="948" href="Scopecheck.html#796" class="Bound">gen</a>

  <a id="955" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="967" class="Symbol">:</a> <a id="969" href="Language.html#680" class="Datatype">Type</a> <a id="974" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="981" class="Symbol">→</a> <a id="983" href="Scopecheck.html#672" class="Function">M</a> <a id="985" class="Symbol">(</a><a id="986" href="Language.html#680" class="Datatype">Type</a> <a id="991" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a><a id="992" class="Symbol">)</a>
  <a id="996" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="1008" class="Symbol">(</a><a id="1009" href="Language.html#709" class="InductiveConstructor">α</a> <a id="1011" href="Scopecheck.html#1011" class="Bound">str</a><a id="1014" class="Symbol">)</a> <a id="1016" class="Symbol">=</a> <a id="1018" href="Language.html#709" class="InductiveConstructor">α</a> <a id="1020" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1024" href="Scopecheck.html#744" class="Function">resolve</a> <a id="1032" href="Scopecheck.html#1011" class="Bound">str</a>
  <a id="1038" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="1050" class="Symbol">(</a><a id="1051" href="Scopecheck.html#1051" class="Bound">σ</a> <a id="1053" href="Language.html#728" class="InductiveConstructor Operator">⇒</a> <a id="1055" href="Scopecheck.html#1055" class="Bound">τ</a><a id="1056" class="Symbol">)</a> <a id="1058" class="Symbol">=</a> <a id="1060" href="Language.html#728" class="InductiveConstructor Operator">_⇒_</a> <a id="1064" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1068" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="1080" href="Scopecheck.html#1051" class="Bound">σ</a> <a id="1082" href="Category.Applicative.Indexed.html#938" class="Function Operator">⊛</a> <a id="1084" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="1096" href="Scopecheck.html#1055" class="Bound">τ</a>

  <a id="1101" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1113" class="Symbol">:</a> <a id="1115" class="Symbol">∀</a> <a id="1117" class="Symbol">{</a><a id="1118" href="Scopecheck.html#1118" class="Bound">i</a> <a id="1120" href="Scopecheck.html#1120" class="Bound">σ</a> <a id="1122" href="Scopecheck.html#1122" class="Bound">Γ</a><a id="1123" class="Symbol">}</a> <a id="1125" class="Symbol">→</a> <a id="1127" href="Generic.Syntax.html#1063" class="Datatype">Tm</a> <a id="1130" class="Symbol">(</a><a id="1131" href="Language.html#2097" class="Function">surface</a> <a id="1139" href="Agda.Builtin.String.html#165" class="Postulate">String</a><a id="1145" class="Symbol">)</a> <a id="1147" href="Scopecheck.html#1118" class="Bound">i</a> <a id="1149" href="Scopecheck.html#1120" class="Bound">σ</a> <a id="1151" href="Scopecheck.html#1122" class="Bound">Γ</a> <a id="1153" class="Symbol">→</a> <a id="1155" href="Scopecheck.html#672" class="Function">M</a> <a id="1157" class="Symbol">(</a><a id="1158" href="Language.html#2517" class="Function">Scoped</a> <a id="1165" href="Scopecheck.html#1120" class="Bound">σ</a> <a id="1167" href="Scopecheck.html#1122" class="Bound">Γ</a><a id="1168" class="Symbol">)</a>
  <a id="1172" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1184" class="Symbol">(</a><a id="1185" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1190" href="Scopecheck.html#1190" class="Bound">k</a><a id="1191" class="Symbol">)</a>          <a id="1202" class="Symbol">=</a> <a id="1204" href="Category.Monad.Indexed.html#569" class="Function">return</a> <a id="1211" href="Function.html#1927" class="Function Operator">$</a> <a id="1213" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1218" href="Scopecheck.html#1190" class="Bound">k</a>
  <a id="1222" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1234" class="Symbol">(</a><a id="1235" href="Scopecheck.html#1235" class="Bound">r</a> <a id="1237" href="Language.html#5003" class="InductiveConstructor Operator">&gt;</a> <a id="1239" href="Scopecheck.html#1239" class="Bound">t</a> <a id="1241" href="Language.html#5003" class="InductiveConstructor Operator">`∶</a> <a id="1244" href="Scopecheck.html#1244" class="Bound">σ</a><a id="1245" class="Symbol">)</a>      <a id="1252" class="Symbol">=</a> <a id="1254" href="Scopecheck.html#1235" class="Bound">r</a> <a id="1256" href="Language.html#5003" class="InductiveConstructor Operator">&gt;_`∶_</a> <a id="1262" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1266" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1278" href="Scopecheck.html#1239" class="Bound">t</a> <a id="1280" href="Category.Applicative.Indexed.html#938" class="Function Operator">⊛</a> <a id="1282" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="1294" href="Scopecheck.html#1244" class="Bound">σ</a>
  <a id="1298" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1310" class="Symbol">(</a><a id="1311" href="Scopecheck.html#1311" class="Bound">r</a> <a id="1313" href="Language.html#5109" class="InductiveConstructor Operator">&gt;</a> <a id="1315" href="Scopecheck.html#1315" class="Bound">f</a> <a id="1317" href="Language.html#5109" class="InductiveConstructor Operator">`$</a> <a id="1320" href="Scopecheck.html#1320" class="Bound">t</a><a id="1321" class="Symbol">)</a>      <a id="1328" class="Symbol">=</a> <a id="1330" href="Scopecheck.html#1311" class="Bound">r</a> <a id="1332" href="Language.html#5109" class="InductiveConstructor Operator">&gt;_`$_</a> <a id="1338" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1342" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1354" href="Scopecheck.html#1315" class="Bound">f</a> <a id="1356" href="Category.Applicative.Indexed.html#938" class="Function Operator">⊛</a> <a id="1358" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1370" href="Scopecheck.html#1320" class="Bound">t</a>
  <a id="1374" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1386" class="Symbol">(</a><a id="1387" href="Scopecheck.html#1387" class="Bound">r</a> <a id="1389" href="Language.html#5211" class="InductiveConstructor Operator">&gt;`λ</a> <a id="1393" href="Scopecheck.html#1393" class="Bound">b</a><a id="1394" class="Symbol">)</a>         <a id="1404" class="Symbol">=</a> <a id="1406" href="Scopecheck.html#1387" class="Bound">r</a> <a id="1408" href="Language.html#5211" class="InductiveConstructor Operator">&gt;`λ_</a>  <a id="1414" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1418" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1430" href="Scopecheck.html#1393" class="Bound">b</a>
  <a id="1434" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1446" class="Symbol">(</a><a id="1447" href="Scopecheck.html#1447" class="Bound">r</a> <a id="1449" href="Language.html#5314" class="InductiveConstructor Operator">&gt;`let</a> <a id="1455" href="Scopecheck.html#1455" class="Bound">e</a> <a id="1457" href="Language.html#5314" class="InductiveConstructor Operator">`in</a> <a id="1461" href="Scopecheck.html#1461" class="Bound">b</a><a id="1462" class="Symbol">)</a> <a id="1464" class="Symbol">=</a> <a id="1466" href="Scopecheck.html#1447" class="Bound">r</a> <a id="1468" href="Language.html#5314" class="InductiveConstructor Operator">&gt;`let_`in_</a> <a id="1479" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1483" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1495" href="Scopecheck.html#1455" class="Bound">e</a> <a id="1497" href="Category.Applicative.Indexed.html#938" class="Function Operator">⊛</a> <a id="1499" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1511" href="Scopecheck.html#1461" class="Bound">b</a>
  <a id="1515" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1527" class="Symbol">(</a><a id="1528" href="Scopecheck.html#1528" class="Bound">r</a> <a id="1530" href="Language.html#5421" class="InductiveConstructor Operator">&gt;`-</a> <a id="1534" href="Scopecheck.html#1534" class="Bound">t</a><a id="1535" class="Symbol">)</a>         <a id="1545" class="Symbol">=</a> <a id="1547" href="Scopecheck.html#1528" class="Bound">r</a> <a id="1549" href="Language.html#5421" class="InductiveConstructor Operator">&gt;`-_</a>  <a id="1555" href="Category.Functor.html#528" class="Function Operator">&lt;$&gt;</a> <a id="1559" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1571" href="Scopecheck.html#1534" class="Bound">t</a>

<a id="1574" class="Keyword">open</a> <a id="1579" href="Category.Monad.html#810" class="Module">RawMonad</a> <a id="1588" class="Symbol">(</a><a id="1589" href="Types.html#1612" class="Function">Compiler.monad</a> <a id="1604" href="Agda.Builtin.String.html#165" class="Postulate">String</a><a id="1610" class="Symbol">)</a>
<a id="1612" class="Keyword">open</a> <a id="1617" href="Types.html#1594" class="Module">Compiler</a>
<a id="1626" class="Keyword">open</a> <a id="1631" href="Generic.AltSyntax.html#1880" class="Module">ScopeCheck</a>

<a id="scopecheck"></a><a id="1643" href="Scopecheck.html#1643" class="Function">scopecheck</a> <a id="1654" class="Symbol">:</a> <a id="1656" class="Symbol">∀</a> <a id="1658" class="Symbol">{</a><a id="1659" href="Scopecheck.html#1659" class="Bound">Σ</a> <a id="1661" href="Scopecheck.html#1661" class="Bound">m</a><a id="1662" class="Symbol">}</a> <a id="1664" class="Symbol">(</a><a id="1665" href="Scopecheck.html#1665" class="Bound">p</a> <a id="1667" class="Symbol">:</a> <a id="1669" href="Language.html#5996" class="Datatype">Definitions</a> <a id="1681" href="Scopecheck.html#1659" class="Bound">Σ</a><a id="1682" class="Symbol">)</a> <a id="1684" class="Symbol">→</a> <a id="1686" href="Language.html#2451" class="Function">Parsed</a> <a id="1693" href="Scopecheck.html#1661" class="Bound">m</a> <a id="1695" class="Symbol">→</a>
             <a id="1710" href="Types.html#1514" class="Function">Compiler</a> <a id="1719" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1726" class="Symbol">(</a><a id="1727" href="Language.html#2517" class="Function">Scoped</a> <a id="1734" href="Scopecheck.html#1661" class="Bound">m</a> <a id="1736" class="Symbol">(</a><a id="1737" href="Language.html#6426" class="Function">modes</a> <a id="1743" href="Scopecheck.html#1665" class="Bound">p</a><a id="1744" class="Symbol">))</a>
<a id="1747" href="Scopecheck.html#1643" class="Function">scopecheck</a> <a id="1758" href="Scopecheck.html#1758" class="Bound">p</a> <a id="1760" href="Scopecheck.html#1760" class="Bound">r</a> <a id="1762" class="Symbol">=</a> <a id="1764" class="Keyword">do</a>
  <a id="1769" class="Keyword">let</a> <a id="1773" href="Scopecheck.html#1773" class="Bound">scopeError</a> <a id="1784" class="Symbol">=</a> <a id="1786" href="Data.Product.html#3500" class="Function">uncurry</a> <a id="1794" href="Types.html#733" class="InductiveConstructor Operator">At_OutOfScope_</a>
  <a id="1811" href="Scopecheck.html#1811" class="Bound">t</a>  <a id="1814" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1816" href="Types.html#1707" class="Function">liftResult</a> <a id="1827" href="Function.html#1927" class="Function Operator">$</a> <a id="1829" href="Data.Sum.Base.html#1378" class="Function">Sum.map₁</a> <a id="1838" href="Scopecheck.html#1773" class="Bound">scopeError</a> <a id="1849" href="Function.html#1927" class="Function Operator">$</a> <a id="1851" href="Generic.AltSyntax.html#2365" class="Function">scopeCheck</a> <a id="1862" href="Language.html#803" class="Function">eqdecMode</a> <a id="1872" class="Symbol">_</a> <a id="1874" class="Symbol">_</a> <a id="1876" class="Symbol">(</a><a id="1877" href="Language.html#6508" class="Function">names</a> <a id="1883" href="Scopecheck.html#1758" class="Bound">p</a><a id="1884" class="Symbol">)</a> <a id="1886" href="Scopecheck.html#1760" class="Bound">r</a>
  <a id="1890" href="Types.html#1779" class="Function">liftState</a> <a id="1900" href="Function.html#1927" class="Function Operator">$</a> <a id="1902" href="Scopecheck.html#1101" class="Function">cleanupTerm</a> <a id="1914" href="Scopecheck.html#1811" class="Bound">t</a>
</pre></body></html>