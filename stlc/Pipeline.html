<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Pipeline</title><link rel="stylesheet" href="Agda.css"></head><body><pre><a id="1" class="Keyword">module</a> <a id="8" href="Pipeline.html" class="Module">Pipeline</a> <a id="17" class="Keyword">where</a>

<a id="24" class="Keyword">open</a> <a id="29" class="Keyword">import</a> <a id="36" href="Data.Product.html" class="Module">Data.Product</a>
<a id="49" class="Keyword">open</a> <a id="54" class="Keyword">import</a> <a id="61" href="Data.String.html" class="Module">Data.String</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Data.Sum.html" class="Module">Data.Sum</a>
<a id="94" class="Keyword">open</a> <a id="99" class="Keyword">import</a> <a id="106" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="121" class="Symbol">as</a> <a id="124" class="Module">List</a>
<a id="129" class="Keyword">import</a> <a id="136" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="155" class="Symbol">as</a> <a id="158" class="Module">List⁺</a>
<a id="164" class="Keyword">open</a> <a id="169" class="Keyword">import</a> <a id="176" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a>
<a id="205" class="Keyword">open</a> <a id="210" class="Keyword">import</a> <a id="217" href="Data.List.Relation.Unary.All.Properties.html" class="Module">Data.List.Relation.Unary.All.Properties</a>
<a id="257" class="Keyword">open</a> <a id="262" class="Keyword">import</a> <a id="269" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a>
<a id="290" class="Keyword">open</a> <a id="295" class="Keyword">import</a> <a id="302" href="Function.html" class="Module">Function</a>
<a id="311" class="Keyword">open</a> <a id="316" class="Keyword">import</a> <a id="323" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>

<a id="362" class="Keyword">open</a> <a id="367" class="Keyword">import</a> <a id="374" href="var.html" class="Module">var</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="var.html#578" class="InductiveConstructor">z</a><a id="386" class="Symbol">;</a> <a id="388" href="var.html#626" class="InductiveConstructor">s</a><a id="389" class="Symbol">)</a>
<a id="391" class="Keyword">open</a> <a id="396" class="Keyword">import</a> <a id="403" href="Generic.Syntax.html" class="Module">Generic.Syntax</a> <a id="418" class="Keyword">using</a> <a id="424" class="Symbol">(</a><a id="425" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a><a id="429" class="Symbol">)</a>
<a id="431" class="Keyword">open</a> <a id="436" class="Keyword">import</a> <a id="443" href="Language.html" class="Module">Language</a><a id="451" class="Symbol">;</a> <a id="453" class="Keyword">open</a> <a id="458" href="Language.html#2190" class="Module">Surface</a>
<a id="466" class="Keyword">open</a> <a id="471" class="Keyword">import</a> <a id="478" href="Types.html" class="Module">Types</a>
<a id="484" class="Keyword">open</a> <a id="489" class="Keyword">import</a> <a id="496" href="Parse.html" class="Module">Parse</a>
<a id="502" class="Keyword">open</a> <a id="507" class="Keyword">import</a> <a id="514" href="Scopecheck.html" class="Module">Scopecheck</a>
<a id="525" class="Keyword">open</a> <a id="530" class="Keyword">import</a> <a id="537" href="Typecheck.html" class="Module">Typecheck</a>
<a id="547" class="Keyword">open</a> <a id="552" class="Keyword">import</a> <a id="559" href="LetInline.html" class="Module">LetInline</a>
<a id="569" class="Keyword">open</a> <a id="574" class="Keyword">import</a> <a id="581" href="Print.html" class="Module">Print</a>

<a id="588" class="Keyword">open</a> <a id="593" class="Keyword">import</a> <a id="600" href="Category.Monad.html" class="Module">Category.Monad</a>

<a id="616" class="Keyword">open</a> <a id="621" href="Category.Monad.html#810" class="Module">RawMonad</a> <a id="630" class="Symbol">(</a><a id="631" href="Types.html#2300" class="Function">Compiler.monad</a> <a id="646" href="Agda.Builtin.String.html#165" class="Postulate">String</a><a id="652" class="Symbol">)</a>
<a id="654" class="Keyword">open</a> <a id="659" href="Types.html#2282" class="Module">Compiler</a>

<a id="declarations"></a><a id="669" href="Pipeline.html#669" class="Function">declarations</a> <a id="682" class="Symbol">:</a> <a id="684" href="Agda.Builtin.List.html#80" class="Datatype">List</a> <a id="689" class="Symbol">(</a><a id="690" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="697" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="699" href="Language.html#764" class="Datatype">Type</a> <a id="704" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="711" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="713" href="Language.html#2722" class="Function">Parsed</a> <a id="720" href="Language.html#1060" class="InductiveConstructor">Check</a><a id="725" class="Symbol">)</a> <a id="727" class="Symbol">→</a>
               <a id="744" class="Symbol">∀</a> <a id="746" class="Symbol">{</a><a id="747" href="Pipeline.html#747" class="Bound">Γ</a><a id="748" class="Symbol">}</a> <a id="750" class="Symbol">→</a> <a id="752" href="Language.html#6267" class="Datatype">Definitions</a> <a id="764" href="Pipeline.html#747" class="Bound">Γ</a> <a id="766" class="Symbol">→</a> <a id="768" href="Types.html#2202" class="Function">Compiler</a> <a id="777" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="784" class="Symbol">(</a><a id="785" href="Data.Product.html#917" class="Function">∃</a> <a id="787" href="Language.html#6267" class="Datatype">Definitions</a><a id="798" class="Symbol">)</a>
<a id="800" href="Pipeline.html#669" class="Function">declarations</a> <a id="813" href="Agda.Builtin.List.html#117" class="InductiveConstructor">[]</a>             <a id="828" href="Pipeline.html#828" class="Bound">p</a> <a id="830" class="Symbol">=</a> <a id="832" href="Category.Applicative.Indexed.html#905" class="Function">pure</a> <a id="837" href="Function.html#1927" class="Function Operator">$</a> <a id="839" href="Data.Product.html#1937" class="Function Operator">-,</a> <a id="842" href="Pipeline.html#828" class="Bound">p</a>
<a id="844" href="Pipeline.html#669" class="Function">declarations</a> <a id="857" class="Symbol">((</a><a id="859" href="Pipeline.html#859" class="Bound">str</a> <a id="863" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="865" href="Pipeline.html#865" class="Bound">sig</a> <a id="869" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="871" href="Pipeline.html#871" class="Bound">decl</a><a id="875" class="Symbol">)</a> <a id="877" href="Agda.Builtin.List.html#132" class="InductiveConstructor Operator">∷</a> <a id="879" href="Pipeline.html#879" class="Bound">decls</a><a id="884" class="Symbol">)</a> <a id="886" href="Pipeline.html#886" class="Bound">p</a> <a id="888" class="Symbol">=</a> <a id="890" class="Keyword">do</a>
  <a id="895" href="Pipeline.html#895" class="Bound">scoped</a> <a id="902" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="904" href="Scopecheck.html#1643" class="Function">scopecheck</a> <a id="915" href="Pipeline.html#886" class="Bound">p</a> <a id="917" href="Pipeline.html#871" class="Bound">decl</a>
  <a id="924" href="Pipeline.html#924" class="Bound">σ</a>      <a id="931" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="933" href="Types.html#2467" class="Function">liftState</a> <a id="943" href="Function.html#1927" class="Function Operator">$</a> <a id="945" href="Scopecheck.html#955" class="Function">cleanupType</a> <a id="957" href="Pipeline.html#865" class="Bound">sig</a>
  <a id="963" href="Pipeline.html#963" class="Bound">typed</a>  <a id="970" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="972" href="Types.html#3658" class="Function">ppCompiler</a> <a id="983" href="Function.html#1927" class="Function Operator">$</a> <a id="985" href="Types.html#2395" class="Function">liftResult</a> <a id="996" href="Function.html#1927" class="Function Operator">$</a> <a id="998" href="Typecheck.html#3940" class="Function">type-</a> <a id="1004" href="Language.html#1060" class="InductiveConstructor">Check</a> <a id="1010" class="Symbol">_</a> <a id="1012" href="Pipeline.html#895" class="Bound">scoped</a> <a id="1019" class="Symbol">(</a><a id="1020" href="Data.List.Relation.Unary.All.Properties.html#3913" class="Function">map⁺</a> <a id="1025" href="Data.List.Relation.Unary.All.html#1974" class="Function">self</a><a id="1029" class="Symbol">)</a> <a id="1031" href="Pipeline.html#924" class="Bound">σ</a>
  <a id="1035" class="Keyword">let</a> <a id="1039" href="Pipeline.html#1039" class="Bound">x</a> <a id="1041" class="Symbol">=</a> <a id="1043" href="Pipeline.html#859" class="Bound">str</a> <a id="1047" href="Language.html#6413" class="InductiveConstructor Operator">∶</a> <a id="1049" href="Pipeline.html#924" class="Bound">σ</a> <a id="1051" href="Language.html#6413" class="InductiveConstructor Operator">≔</a> <a id="1053" href="Relation.Binary.PropositionalEquality.Core.html#978" class="Function">subst</a> <a id="1059" class="Symbol">(</a><a id="1060" href="Language.html#3611" class="Function">Internal.Typed</a> <a id="1075" class="Symbol">_)</a> <a id="1078" class="Symbol">(</a><a id="1079" href="Typecheck.html#952" class="Function">eq^fromTyping</a> <a id="1093" class="Symbol">_)</a> <a id="1096" href="Pipeline.html#963" class="Bound">typed</a>
  <a id="1104" href="Pipeline.html#669" class="Function">declarations</a> <a id="1117" href="Pipeline.html#879" class="Bound">decls</a> <a id="1123" class="Symbol">(</a><a id="1124" href="Pipeline.html#886" class="Bound">p</a> <a id="1126" href="Language.html#6596" class="InductiveConstructor Operator">&amp;</a> <a id="1128" href="Pipeline.html#1039" class="Bound">x</a><a id="1129" class="Symbol">)</a>

<a id="declaration"></a><a id="1132" href="Pipeline.html#1132" class="Function">declaration</a> <a id="1144" class="Symbol">:</a> <a id="1146" href="Language.html#2722" class="Function">Parsed</a> <a id="1153" href="Language.html#1054" class="InductiveConstructor">Infer</a> <a id="1159" class="Symbol">→</a> <a id="1161" class="Symbol">∀</a> <a id="1163" class="Symbol">{</a><a id="1164" href="Pipeline.html#1164" class="Bound">Γ</a><a id="1165" class="Symbol">}</a> <a id="1167" class="Symbol">→</a> <a id="1169" href="Language.html#6267" class="Datatype">Definitions</a> <a id="1181" href="Pipeline.html#1164" class="Bound">Γ</a> <a id="1183" class="Symbol">→</a>
              <a id="1199" href="Types.html#2202" class="Function">Compiler</a> <a id="1208" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1215" class="Symbol">(</a><a id="1216" href="Data.Product.html#917" class="Function">∃</a> <a id="1218" class="Symbol">λ</a> <a id="1220" href="Pipeline.html#1220" class="Bound">σ</a> <a id="1222" class="Symbol">→</a> <a id="1224" href="Language.html#6913" class="Function">Expression</a> <a id="1235" href="Pipeline.html#1220" class="Bound">σ</a> <a id="1237" href="Pipeline.html#1164" class="Bound">Γ</a><a id="1238" class="Symbol">)</a>
<a id="1240" href="Pipeline.html#1132" class="Function">declaration</a> <a id="1252" href="Pipeline.html#1252" class="Bound">d</a> <a id="1254" class="Symbol">{</a><a id="1255" href="Pipeline.html#1255" class="Bound">Γ</a><a id="1256" class="Symbol">}</a> <a id="1258" href="Pipeline.html#1258" class="Bound">p</a> <a id="1260" class="Symbol">=</a> <a id="1262" class="Keyword">do</a>
  <a id="1267" href="Pipeline.html#1267" class="Bound">scoped</a>      <a id="1279" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1281" href="Scopecheck.html#1643" class="Function">scopecheck</a> <a id="1292" href="Pipeline.html#1258" class="Bound">p</a> <a id="1294" href="Pipeline.html#1252" class="Bound">d</a>
  <a id="1298" class="Symbol">(</a><a id="1299" href="Pipeline.html#1299" class="Bound">σ</a> <a id="1301" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1303" href="Pipeline.html#1303" class="Bound">typed</a><a id="1308" class="Symbol">)</a> <a id="1310" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1312" href="Types.html#3658" class="Function">ppCompiler</a> <a id="1323" href="Function.html#1927" class="Function Operator">$</a> <a id="1325" href="Types.html#2395" class="Function">liftResult</a> <a id="1336" href="Function.html#1927" class="Function Operator">$</a> <a id="1338" href="Typecheck.html#3940" class="Function">type-</a> <a id="1344" href="Language.html#1054" class="InductiveConstructor">Infer</a> <a id="1350" href="Pipeline.html#1255" class="Bound">Γ</a> <a id="1352" href="Pipeline.html#1267" class="Bound">scoped</a> <a id="1359" class="Symbol">(</a><a id="1360" href="Data.List.Relation.Unary.All.Properties.html#3913" class="Function">map⁺</a> <a id="1365" href="Data.List.Relation.Unary.All.html#1974" class="Function">self</a><a id="1369" class="Symbol">)</a>
  <a id="1373" href="Category.Applicative.Indexed.html#905" class="Function">pure</a> <a id="1378" class="Symbol">(</a><a id="1379" href="Pipeline.html#1299" class="Bound">σ</a> <a id="1381" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1383" href="Relation.Binary.PropositionalEquality.Core.html#978" class="Function">subst</a> <a id="1389" class="Symbol">(</a><a id="1390" href="Language.html#3611" class="Function">Internal.Typed</a> <a id="1405" class="Symbol">_)</a> <a id="1408" class="Symbol">(</a><a id="1409" href="Typecheck.html#952" class="Function">eq^fromTyping</a> <a id="1423" class="Symbol">_)</a> <a id="1426" href="Pipeline.html#1303" class="Bound">typed</a><a id="1431" class="Symbol">)</a>

<a id="pipeline"></a><a id="1434" href="Pipeline.html#1434" class="Function">pipeline</a> <a id="1443" class="Symbol">:</a> <a id="1445" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1452" class="Symbol">→</a> <a id="1454" href="Types.html#718" class="Datatype">Error</a> <a id="1460" href="Agda.Builtin.String.html#165" class="Postulate">String</a> <a id="1467" href="Data.Sum.Base.html#509" class="Datatype Operator">⊎</a> <a id="1469" href="Language.html#7038" class="Datatype">Program</a>
<a id="1477" href="Pipeline.html#1434" class="Function">pipeline</a> <a id="1486" href="Pipeline.html#1486" class="Bound">str</a> <a id="1490" class="Symbol">=</a> <a id="1492" href="Types.html#2775" class="Function">Compiler.run</a> <a id="1505" href="Function.html#1927" class="Function Operator">$</a> <a id="1507" class="Keyword">do</a>
  <a id="1512" class="Symbol">(</a><a id="1513" href="Pipeline.html#1513" class="Bound">decls</a> <a id="1519" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1521" href="Pipeline.html#1521" class="Bound">expr</a><a id="1525" class="Symbol">)</a> <a id="1527" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1529" href="Types.html#2395" class="Function">liftResult</a> <a id="1540" href="Function.html#1927" class="Function Operator">$</a> <a id="1542" href="Parse.html#5414" class="Function">parse</a> <a id="1548" href="Pipeline.html#1486" class="Bound">str</a>
  <a id="1554" class="Symbol">(</a><a id="1555" href="Pipeline.html#1555" class="Bound">Γ</a> <a id="1557" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1559" href="Pipeline.html#1559" class="Bound">defs</a><a id="1563" class="Symbol">)</a>     <a id="1569" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1571" href="Pipeline.html#669" class="Function">declarations</a> <a id="1584" class="Symbol">(</a><a id="1585" href="Data.List.NonEmpty.html#1701" class="Function">List⁺.toList</a> <a id="1598" href="Pipeline.html#1513" class="Bound">decls</a><a id="1603" class="Symbol">)</a> <a id="1605" href="Language.html#6573" class="InductiveConstructor">[]</a>
  <a id="1610" class="Symbol">(</a><a id="1611" href="Pipeline.html#1611" class="Bound">σ</a> <a id="1613" href="Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="1615" href="Pipeline.html#1615" class="Bound">eval</a><a id="1619" class="Symbol">)</a>     <a id="1625" href="Category.Monad.Indexed.html#604" class="Function Operator">←</a> <a id="1627" href="Pipeline.html#1132" class="Function">declaration</a> <a id="1639" href="Pipeline.html#1521" class="Bound">expr</a> <a id="1644" href="Pipeline.html#1559" class="Bound">defs</a>
  <a id="1651" href="Category.Applicative.Indexed.html#905" class="Function">pure</a> <a id="1656" href="Function.html#1927" class="Function Operator">$</a> <a id="1658" href="Language.html#7060" class="InductiveConstructor Operator">assuming</a> <a id="1667" href="Pipeline.html#1559" class="Bound">defs</a> <a id="1672" href="Language.html#7060" class="InductiveConstructor Operator">have</a> <a id="1677" href="Pipeline.html#1615" class="Bound">eval</a>

<a id="1683" class="Keyword">open</a> <a id="1688" class="Keyword">import</a> <a id="1695" href="Agda.Builtin.Equality.html" class="Module">Agda.Builtin.Equality</a>

<a id="1718" href="Pipeline.html#1718" class="Function">_</a> <a id="1720" class="Symbol">:</a> <a id="1722" href="Data.Sum.html#1158" class="Function">from-inj₂</a> <a id="1732" class="Symbol">(</a><a id="1733" href="Pipeline.html#1434" class="Function">pipeline</a> <a id="1742" class="String">&quot;def id  : &#39;a → &#39;a = λx. x
\            \def snd : &#39;a → &#39;b → &#39;b = λx. λy.y
\            \eval id&quot;</a><a id="1839" class="Symbol">)</a>
  <a id="1843" href="Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="1845" href="Language.html#7060" class="InductiveConstructor Operator">assuming</a> <a id="1854" href="Language.html#6573" class="InductiveConstructor">[]</a>
  <a id="1859" href="Language.html#6596" class="InductiveConstructor Operator">&amp;</a> <a id="1861" class="String">&quot;id&quot;</a>  <a id="1867" href="Language.html#6413" class="InductiveConstructor Operator">∶</a> <a id="1869" href="Language.html#793" class="InductiveConstructor">α</a> <a id="1871" class="Number">0</a> <a id="1873" href="Language.html#812" class="InductiveConstructor Operator">⇒</a> <a id="1875" href="Language.html#793" class="InductiveConstructor">α</a> <a id="1877" class="Number">0</a>       <a id="1885" href="Language.html#6413" class="InductiveConstructor Operator">≔</a> <a id="1887" href="Language.html#4813" class="InductiveConstructor Operator">`λ</a> <a id="1890" href="Language.html#5108" class="InductiveConstructor Operator">`-</a> <a id="1893" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1898" href="var.html#578" class="InductiveConstructor">z</a>
  <a id="1902" href="Language.html#6596" class="InductiveConstructor Operator">&amp;</a> <a id="1904" class="String">&quot;snd&quot;</a> <a id="1910" href="Language.html#6413" class="InductiveConstructor Operator">∶</a> <a id="1912" href="Language.html#793" class="InductiveConstructor">α</a> <a id="1914" class="Number">0</a> <a id="1916" href="Language.html#812" class="InductiveConstructor Operator">⇒</a> <a id="1918" href="Language.html#793" class="InductiveConstructor">α</a> <a id="1920" class="Number">1</a> <a id="1922" href="Language.html#812" class="InductiveConstructor Operator">⇒</a> <a id="1924" href="Language.html#793" class="InductiveConstructor">α</a> <a id="1926" class="Number">1</a> <a id="1928" href="Language.html#6413" class="InductiveConstructor Operator">≔</a> <a id="1930" href="Language.html#4813" class="InductiveConstructor Operator">`λ</a> <a id="1933" href="Language.html#4813" class="InductiveConstructor Operator">`λ</a> <a id="1936" href="Language.html#5108" class="InductiveConstructor Operator">`-</a> <a id="1939" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1944" href="var.html#578" class="InductiveConstructor">z</a>
  <a id="1948" href="Language.html#7060" class="InductiveConstructor Operator">have</a> <a id="1953" href="Generic.Syntax.html#1116" class="InductiveConstructor">`var</a> <a id="1958" class="Symbol">(</a><a id="1959" href="var.html#626" class="InductiveConstructor">s</a> <a id="1961" href="var.html#578" class="InductiveConstructor">z</a><a id="1962" class="Symbol">)</a>
<a id="1964" class="Symbol">_</a> <a id="1966" class="Symbol">=</a> <a id="1968" href="Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
</pre></body></html>